<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="/someCSS.css" rel="stylesheet">
</head>

<body>
	<div id="nav-bar-div" style="display: none;"></div>

	<div class="container-fluid">

		<div id="before-login-div" style="display: block;"></div>

		<div id="after-login-div" class="row" style="display: none;">
			<div class="col-md-2" sidebar>
				<div class="row">
					<div id="patientInfo-sidebar-div"></div>
				</div>
			</div>
			<div class="col-md-10" main>
				<div class="row">
					<div class="col-md-6 pre-scrollable" id="middle-div" style="max-height: 90vh;">
						<div id="patientRecords-div"></div>
						<div id="recordDetail-div"></div>
					</div>
					<div class="col-md-6" id="right-div">
						<div id="doctorInfo-div"></div>
						<div id="inspection-div"></div>
					</div>
				</div>
			</div>
		</div>

	</div>
</body>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script> window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>') </script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/doc/inspection.js"></script>

<script type="text/javascript">

	var globalPid;
	var globalDid;
	var hname = "";

	var socket = io();
	socket.emit("newPatient", {});


	$("#nav-bar-div").load("/patient/nav.html");
	$("#before-login-div").load("/patient/before-login.html");

	$("#patientInfo-sidebar-div").load("/patient/patientInfo.html");

	$("#patientRecords-div").load("/patientRecords.html");
	$("#recordDetail-div").load("/doc/recordDetail.html");

	$("#doctorInfo-div").load("/patient/doctorInfo.html");
	$("#inspection-div").load("/patient/inspection.html");

	$(function() {

		$.ajax({
			type: "GET",
			url: "/getHospitalName",
			success: function(text) {
				hname = text;
				console.log("ajax.getHospitalName hname: ", hname);
				// document.getElementById("before-login-hname").innerHTML = "欢迎来到" + hname;
				document.getElementById("before-login-hname").innerHTML = hname;
				document.getElementById("nav-hname").innerHTML = hname;
			}
		});

		socket.on('event', function(data) {
			console.log(data);
			if (data.EventType === "newRecord") {
				var payload = JSON.parse(data.Payload);
				if (payload.Did === globalDid && payload.Pid === globalPid) {
					console.log("patient has new record");
					socket.emit('getPatientRecords', {
						did: globalDid,
						pid: globalPid
					});
				}
			}
		});

	})
</script>

</html>

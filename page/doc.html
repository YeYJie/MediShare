<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="/someCSS.css" rel="stylesheet">
</head>

<body>
	<div id="nav-bar-div" style="display: none;"></div>

	<div class="container-fluid">
		<div id="before-login-div" style="display: block;"></div>
		<div id="after-login" class="row" style="display: none;">
			<div class="col-md-2" sidebar>
				<div class="row">
					<div id="doctorInfo-sidebar-div"></div>
				</div>
				<div class="row">
					<div id="patientList-div"></div>
				</div>
			</div>
			<div class="col-md-10" main>
				<div class="row">
					<div class="col-md-6" id="middle-div">
						<div id="patientInfo-sidebar-div"></div>
						<div id="diagnose-div"></div>
					</div>
					<div class="col-md-6" id="right-div">
						<div id="patientRecords-div"></div>
						<div id="recordDetail-div"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

</body>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script> window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>') </script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script src="/doc/inspection.js"></script>

<script type="text/javascript">
	var socket = io();
	var globalDid = "123456";
	var globalPid;
	var isJianyanke = false;

	$("#nav-bar-div").load("/nav.html");
	$("#before-login-div").load("/before-login.html");
	$("#doctorInfo-sidebar-div").load("/doctorInfo.html");
	$("#patientInfo-sidebar-div").load("/patientInfo.html");
	$("#patientList-div").load("/patientList.html");

	$("#patientRecords-div").load("/doc/patientRecords.html");
	$("#diagnose-div").load("/doc/diagnose.html");
	$("#recordDetail-div").load("/doc/recordDetail.html");

	socket.on('event', function(data) {
		console.log(data);
		if (data.EventType === "deRegister") {
			var payload = JSON.parse(data.Payload);
			if (payload.Doctor === globalDid) {
				console.log("patient deRegister from me");
				var pid = payload.Patient;
				var index = myPatients.indexOf(pid);
				if (index > -1)
					myPatients.splice(index, 1);
				$("#patient-block-" + pid).remove();
			}
		} else if (data.EventType === "register") {
			var payload = JSON.parse(data.Payload);
			if (payload.Doctor === globalDid) {
				$.ajax({
					type: "GET",
					url: "/getDoctorsPatients/" + globalDid,
					success: function(doctorPatients) {
						console.log("[ajax getDoctorsPatients]: ", doctorPatients);
						processPatients(doctorPatients.patients);
					},
					error: function(xhr) {
					}
				});
			}
		} else if (data.EventType === "newRecord") {
			var payload = JSON.parse(data.Payload);
			if (payload.Did === globalDid && payload.Pid === globalPid) {
				console.log("patient has new record");
				socket.emit('getPatientRecords', {
					did: globalDid,
					pid: globalPid
				});
			}
		}
	});
</script>

</html>

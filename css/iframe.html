<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<style>
			.view {
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;
			}
			body {
				background: white;
			}
		</style>
		<script type="text/javascript" src="/ht.js"></script>
		<script type="text/javascript" src="/ht-flow.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	</head>
	<body onload="init();">
	<div id="flow-div" style="height: 100%; width: 100%;"></div>
	</body>

<script type="text/javascript">

var graph;
var dm;
var view;

function init() {
	console.log("init...");
	graph = window.graph = new ht.graph.GraphView();
	dm = graph.dm();
	view = graph.getView();

	graph.setInteractors(new ht.List([
		new ht.graph.ScrollBarInteractor(graph),
		new ht.graph.SelectInteractor(graph),
		new ht.graph.MoveInteractor(graph),
		new ht.graph.DefaultInteractor(graph),
		new ht.graph.TouchInteractor(graph , {editable: false})
	]));
	view.className = "view";
	// document.body.appendChild(view);
	document.getElementById("flow-div").appendChild(view);

	// graph.translate(-40, -20);
	// graph.setZoom(0.8);
	graph.enableFlow(60);


addHospital("1");
addHospital("2");
addHospital("3");

}


var hList = new Map();
var eList = new Map();

function newNode(hid, x, y) {
	var res = new ht.Node("shit");
	res.setName(hid);
	res.setSize(80, 80);
	return res;
}

function newEdge(from, to) {
	var res = new ht.Edge(from, to);
	res.setStyle("color", "#000000");
	res.setStyle("width", "5");
	return res;
}

function addHospital(newhid) {
	var newh = newNode(newhid);
	dm.add(newh);
	eList[newhid] = new Map();
	for(var hid in hList) {
		var node = hList[hid];
		console.log("addHospital forloop ", hid, node);
		var e1 = newEdge(newh, node);
		var e2 = newEdge(node, newh);
		dm.add(e1); dm.add(e2);
		eList[newhid][hid] = e1;
		eList[hid][newhid] = e2;
	}
	hList[newhid] = newh;
}

var flowingEdge = [];

function showFlow(fromHid, toHid) {
	if(!hList[fromHid] || !hList[toHid]) {
		console.log("showFlow error: !hList[fromHid] || !hList[toHid]");
		return;
	}
	var e = eList[fromHid][toHid];
	if(!e) {
		console.log("showFlow error: eList[fromHid][toHid] not exists");
		return;
	}
	e.s("flow", true);
	e.setStyle("flow.count", 10);
	flowingEdge.push(e);
}

function addFlowForEdge(e) {
	e.s("flow", true);
	e.setStyle("flow.count", 10);
	flowingEdge.push(e);
}

function removeAllFlow() {
	for(var i = 0; i < flowingEdge.length; i++) {
		flowingEdge[i].s("flow", false);
	}
}


</script>

</html>

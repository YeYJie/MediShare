!function(v){"use strict";var W="ht",s=v[W],p=s.Default,o=Math,c=o.PI,O=2*c,J=o.sin,$=o.cos,x=o.atan2,b=o.sqrt,S=o.max,t=o.floor,Q=(o.round,o.ceil),h=o.abs,P=s.Shape,M=s.Edge,N=s.List,f=s.Style,F=s.graph,m=p.getInternal(),D=m.ui(),e=null,T="__segmentLengths",Y="__lineTotalLength",B="__linePoints",n="__distance0",y="flow.count",K="flow.step",_="flow.element.max",r="flow.element.count",E="flow.element.min",u="flow.element.space",i="flow.element.autorotate",l="flow.element.background",A="flow.element.shadow.max",R="flow.element.shadow.min",X="flow.element.shadow.begincolor",z="flow.element.shadow.endcolor",Z="flow.element.shadow.visible",U="flow.element.image",k="flow",G="prototype",H=F.GraphView[G],a=s.Data[G],q=D.DataUI[G],I=D.ShapeUI[G],j=D.EdgeUI[G],C=s.DataModel[G],w=I._80o,L=j._80o,V=C.prepareRemove,g=j._79o,d=I._79o,ic=H.setDataModel,Vq=function(U){return document.createElement(U)};H.calculatePointLength=function(L,Y,B){var P=this,I=P.getDataUI(L);B==e&&(B=.1);var j=_j(I),m=[];if(j){for(var b=j.length,T=0;b>T;T++){var H=j[T];H._as&&(H=H._as);for(var k=H[0],Q=1;Q<H.length;Q++)m.push([k,H[Q]]),k=H[Q]}for(var w=[],T=0;T<m.length;T++){var i=nb(m[T][0],m[T][1],Y);w.push(i)}var _=w.slice(0);_.sort(function(Q,r){return Q.z>r.z?1:Q.z<r.z?-1:0});var n=_[0];if(n.z<B){for(var g=w.indexOf(n),l=0,T=0;g>=T;T++)l+=g>T?p.getDistance(m[T][0],m[T][1]):p.getDistance(m[T][0],n);return l}}},p.calculatePointLength=function(J,O,q,z){z==e&&(z=.1);var R=_j(e,J,O),O=[];if(R){for(var c=R.length,N=0;c>N;N++){var W=R[N];W._as&&(W=W._as);for(var C=W[0],S=1;S<W.length;S++)O.push([C,W[S]]),C=W[S]}for(var V=[],N=0;N<O.length;N++){var M=nb(O[N][0],O[N][1],q);V.push(M)}var s=V.slice(0);s.sort(function(p,r){return p.z>r.z?1:p.z<r.z?-1:0});var r=s[0];if(r.z<z){for(var L=V.indexOf(r),K=0,N=0;L>=N;N++)K+=L>N?p.getDistance(O[N][0],O[N][1]):p.getDistance(O[N][0],r);return K}}},H.calculateClosestPoint=function(m,p){var $=this,P=$.getDataUI(m),X=_j(P),u=[];if(X){for(var h=X.length,S=0;h>S;S++){var b=X[S];b._as&&(b=b._as);for(var R=b[0],B=1;B<b.length;B++)u.push([R,b[B]]),R=b[B]}for(var s=[],S=0;S<u.length;S++){var Y=nb(u[S][0],u[S][1],p);s.push(Y)}return s.sort(function(b,K){return b.z>K.z?1:b.z<K.z?-1:0}),s[0]}},p.calculateClosestPoint=function(y,P,s){var S=_j(e,y,P),P=[];if(S){for(var $=S.length,L=0;$>L;L++){var I=S[L];I._as&&(I=I._as);for(var o=I[0],E=1;E<I.length;E++)P.push([o,I[E]]),o=I[E]}for(var p=[],L=0;L<P.length;L++){var B=nb(P[L][0],P[L][1],s);p.push(B)}return p.sort(function(S,t){return S.z>t.z?1:S.z<t.z?-1:0}),p[0]}},H.getPercentAngle=function(N,F){var u=this,X=u.getDataUI(N),R=N.getRotation?N.getRotation():0,r=_j(X);if(r)if(0===F){var f=r[0][0],q=r[0][1];R+=x(q.y-f.y,q.x-f.x)}else if(100===F){r=r[r.length-1];var f=r[r.length-2],q=r[r.length-1];R+=x(q.y-f.y,q.x-f.x)}else{for(var t=0,h=[],L=r.length,$=0;L>$;$++){var o=r[$],Y=cc(o);t+=Y,h.push(Y)}for(var c=t*F/100,p=Td(c,h),W=0,g=0;p>g;g++)W+=h[g];c-=W;for(var B=qi(r[p],c),D=r[p],S=0,O=0,l=0;l<D.length-1;l++){var j=D[l],A=D[l+1],_=A.x-j.x,V=A.y-j.y,k=b(_*_+V*V);if(S+=k,S>c){O=l;break}}var a=D[O];R+=x(B.y-a.y,B.x-a.x)}return R},p.getPercentAngle=function(j,q,Y){var f=0,G=_j(e,j,q);if(G)if(0===Y){var o=G[0][0],y=G[0][1];f+=x(y.y-o.y,y.x-o.x)}else if(100===Y){G=G[G.length-1];var o=G[G.length-2],y=G[G.length-1];f+=x(y.y-o.y,y.x-o.x)}else{for(var l=0,s=[],k=G.length,g=0;k>g;g++){var v=G[g],T=cc(v);l+=T,s.push(T)}for(var F=l*Y/100,W=Td(F,s),O=0,H=0;W>H;H++)O+=s[H];F-=O;for(var d=qi(G[W],F),V=G[W],S=0,M=0,n=0;n<V.length-1;n++){var m=V[n],c=V[n+1],D=c.x-m.x,_=c.y-m.y,U=b(D*D+_*_);if(S+=U,S>F){M=n;break}}var Q=V[M];f+=x(d.y-Q.y,d.x-Q.x)}return f},H.calculateLength=function(I){var F=this,m=F.getDataUI(I),f=_j(m),U=0;if(f)if(Array.isArray(f[0]))for(var d=f.length,R=0;d>R;R++){var A=f[R],q=cc(A);U+=q}else U=cc(f);return U},p.calculateLength=function(I,R){var I=_j(e,I,R),S=0;if(I)if(Array.isArray(I[0]))for(var x=I.length,s=0;x>s;s++){var y=I[s],A=cc(y);S+=A}else S=cc(I);return S};var nb=p.calculateClosestPointOnLine=function(f,S,q){var A=f.x,J=f.y,l=S.x,V=S.y,U=q.x,Y=q.y,j={},s=l-A,$=V-J,G=Math.sqrt(s*s+$*$),d=s/G,P=$/G,z=(-A+U)*d+(-J+Y)*P;return j.x=A+z*d,j.y=J+z*P,Uk(j,f,S)||(j.x=Math.abs(j.x-f.x)<Math.abs(j.x-S.x)?f.x:S.x,j.y=Math.abs(j.y-f.y)<Math.abs(j.y-S.y)?f.y:S.y),s=U-j.x,$=Y-j.y,j.z=Math.sqrt(s*s+$*$),j},Uk=function(T,I,V){return T.x>=Math.min(I.x,V.x)&&T.x<=Math.max(I.x,V.x)&&T.y>=Math.min(I.y,V.y)&&T.y<=Math.max(I.y,V.y)},cc=function(g){for(var j=0,o=g.length-1,_=0;o>_;_++){var n=g[_],y=g[_+1],p=y.x-n.x,K=y.y-n.y,d=b(p*p+K*K);j+=d}return j},qi=function(H,B){for(var Q=0,V=0,i=0,Z=H.length-1,t=0;Z>t;t++){var R=H[t],m=H[t+1],q=m.x-R.x,A=m.y-R.y;if(i=b(q*q+A*A),Q+=i,Q>B){Q-=i,V=t;break}}var F=H[V],I=H[V+1],M=x(I.y-F.y,I.x-F.x),U=B-Q,A=J(M)*U,q=$(M)*U;return{x:F.x+q,y:F.y+A}},Xi=function(n,c,w,t){var S=$(t),y=J(t),_=S*c-y*w,Z=y*c+S*w;return n?{x:n.x+_,y:n.y+Z}:{x:_,y:Z}},Wd=function(H,N){H[T]=H[Y]=H[B]=N[n]=e},$g=function(f,v,E,b,g,D){var x,o,A,t,e,U,F,X,l,V,T,r=[];if(h(b)>O&&(b=O),e=Q(h(b)/(c/4)),x=b/e,o=-x,A=-E,e>0){U=f+$(E)*g,F=v+J(-E)*D,r.push({x:U,y:F});for(var z=0;e>z;z++)A+=o,t=A-o/2,X=f+$(A)*g,l=v+J(A)*D,V=f+$(t)*(g/$(o/2)),T=v+J(t)*(D/$(o/2)),r.push({x:V,y:T}),r.push({x:X,y:l})}return r},_j=function(Z,o,$){if(o==e){var h=Z._data;if(h instanceof P){if(o=h.getPoints(),$=h.getSegments(),(!$||0===$.size())&&o){$=new s.List([1]);for(var l=1;l<o.size();l++)$.add(2)}}else if(h instanceof M){var f=Z._78o;if(f){var F=f.type,u=f.points,I=f.segments,q=f.edgeTypeInfo;if(!F||u){var w=f.sourcePoint,C=w.x,V=w.y,A=f.targetPoint,S=A.x,K=A.y;if(F)I?(o=new N({x:C,y:V}),o.addAll(u),o.add({x:S,y:K}),$=new N(I._as)):(o=new N({x:C,y:V}),$=new N([1]),u.each(function(g){o.add(g),$.add(2)}),o.add({x:S,y:K}),$.add(2));else if(f.looped){o=new N($g(C,V,0,O,f.radius,f.radius)),$=new N([1]);for(var l=0;l<(o.size()-1)/2;l++)$.add(3)}else o=new N,f.center?(o.add({x:f.c1.x,y:f.c1.y}),o.add({x:C,y:V}),o.add({x:S,y:K}),o.add({x:f.c2.x,y:f.c2.y}),$=new N([1,2,2,2])):(o.add({x:C,y:V}),o.add({x:S,y:K}),$=new N([1,2]))}else if(q)if(o=new N(q.points._as),q.segments)$=new N(q.segments._as);else{$=new N([1]);for(var l=1;l<q.points.size();l++)$.add(2)}}}}if(o){if(Array.isArray(o)&&(o=new N(o)),"number"==typeof o.get(0)){for(var j=new s.List,l=0;l<o.size();l+=2)j.add({x:o.get(l),y:o.get(l+1)});o=j}if(!$){$=[];for(var l=0;l<o.size();l++)0===l?$.push(1):$.push(2)}Array.isArray($)&&($=new N($));for(var n=m.toPointsArray(o._as,$._as,50),r=n.length,Q=[],l=0;r>l;l++){var W=n[l];W.length>1&&Q.push(W)}return Q}},yh=function(j){var Q=j._data,n=_j(j);if(n){Q.s("flow.reverse")&&(n.reverse(),n.forEach(function(r){r.reverse()}));for(var s=0,E=[],u=n.length,W=0;u>W;W++){var _=n[W],G=cc(_);s+=G,E.push(G)}if(Q[T]=E,Q[Y]=s,Q[B]=n,Q instanceof M){var a=p.unionPoint(n),y=a.x+a.width/2,e=a.y+a.height/2;Q.$10e={x:y,y:e}}hg(j,!0)}},hg=(p.getPercentPositionOnPoints=function(j,I,w){if(j){var C=_j(e,j,I);if(C){var d;if(0===w)d=C[0][0];else if(100===w)C=C[C.length-1],d=C[C.length-1];else{for(var F=0,B=[],U=C.length,m=0;U>m;m++){var a=C[m],Y=cc(a);F+=Y,B.push(Y)}for(var D=F*w/100,M=Td(D,B),o=0,A=0;M>A;A++)o+=B[A];D-=o,d=qi(C[M],D)}return d}}},H.getPercentPosition=function(D,Y){var H=this,v=H.getDataUI(D),q=_j(v);if(q){var K;if(0===Y)K=q[0][0];else if(100===Y)q=q[q.length-1],K=q[q.length-1];else{for(var T=0,u=[],l=q.length,V=0;l>V;V++){var j=q[V],F=cc(j);T+=F,u.push(F)}for(var d=T*Y/100,s=Td(d,u),x=0,C=0;s>C;C++)x+=u[C];d-=x,K=qi(q[s],d)}return K}},function(d,x){var W=d._data,D=W[Y],S=W.s(y),X=W.s(K),c=0,p=W[T],k=W.s(_),J=W.s(E),U=W.s(r),O=(k-J)/(U-1),Q=[];if(p){if(1===U)Q.push(k);else if(2===U)Q.push(k),Q.push(J);else{if(!(U>2))return;Q.push(k);for(var t=U-2;t>0;t--)Q.push(J+O*t);Q.push(J)}var l=0,u=0;Q.forEach(function(R){U-1>l&&(u+=W.getFlowElementSpace(R)),l++}),u+=(k+J)/2,c=(D-S*u+u)/S;var s=d[n];for(null==s&&(s=0),x||(s+=X);s>D+u;){var g=d._overCount;g?g++:g=1,g>=S&&(g=null),d._overCount=g,W.s("flow.autoreverse")?g?s-=c+u:(s=0,W.s("flow.reverse",!W.s("flow.reverse"))):s-=c+u}d[n]=s}}),Qp=function($){var J=$.data,Z=this.dm();if(J&&"add"===$.kind){var V=Z.$3e;V&&J.s(k)&&V.indexOf(J)<0&&V.push(J)}"clear"===$.kind&&(Z.$3e=[])},sk=function(b){var j=b.property,P=b.data,B=b.newValue,w=this.dm().$3e;if(w&&"s:flow"===j)if(B)w.indexOf(P)<0&&w.push(P);else for(var T=w.length,y=0;T>y;y++)if(w[y]===P){w.splice(y,1);break}},Td=Td=function(Z,N){for(var z=0,n=N.length,v=0;n>v;v++){var q=N[v];if(z+=q,z>Z)return v}return Math.min(v,n-1)},Fe=function($){var D=this,f=D._data,Q=f[Y],k=f[T],h=f[B],P=f.s(y),w=0,V=D[n],p=f.s(_),K=f.s(E),G=f.s(r),g=f.s(R),U=f.s(A),z=f.s(i),L=(U-g)/(G-1),l=(p-K)/(G-1),s=f.getRotation?f.getRotation():0,q=f.getPosition?f.p():f.$10e,o=[],O=[];if(V!=e){if(1===G)o.push(p);else if(2===G)o.push(p),o.push(K);else{if(!(G>2))return;o.push(p);for(var J=G-2;J>0;J--)o.push(K+l*J);o.push(K)}if(1===G)O.push(U);else if(2===G)O.push(U),O.push(g);else{if(!(G>2))return;O.push(U);for(var J=G-2;J>0;J--)O.push(g+L*J);O.push(g)}var N=0,M=0;o.forEach(function(l){G-1>N&&(M+=f.getFlowElementSpace(l)),N++}),M+=(p+K)/2,w=(Q-P*M+M)/P,$.save();for(var J=0;P>J;J++){var j=V,c=0,d=D._overCount,v=0;f.s("flow.autoreverse")&&d&&d>P-(J+1)||(j-=J*(w+M),N=0,o.forEach(function(P){var L=j-c;if(L>=0&&Q>L){var y=!0,r=Td(L,k);v=0;for(var p=0;r>p;p++)v+=k[p];if(L-=v,y){var X=qi(h[r],L),W=s;if(z){for(var w=h[r],Z=0,J=0,R=0;R<w.length-1;R++){var B=w[R],l=w[R+1],m=l.x-B.x,H=l.y-B.y,C=b(m*m+H*H);if(Z+=C,Z>L){J=R;break}}var V=w[J];W+=x(X.y-V.y,X.x-V.x)}s&&(X=Xi(q,X.x-q.x,X.y-q.y,s)),D.$5e($,X,P,O[N],W)}}c+=f.getFlowElementSpace(o[N]),N++}))}$.restore()}},Hc=function(){var E=this,B=E._data,$=B.s(_),Y=!1,s=e;if(E._6I||(Y=!0),s=B instanceof M?g.call(E):d.call(E),B.s(k)&&Y){var L=B.s(A),R=B.s(Z);R&&L>$&&($=L),$>0&&p.grow(s,Q($/2)),yh(E)}return!B.s(k)&&Y&&Wd(B,E),s};a.getFlowElementSpace=function(){return this.s(u)},I._79o=Hc,j._79o=Hc,f[_]==e&&(f[_]=7),f[E]==e&&(f[E]=0),f[y]==e&&(f[y]=1),f[K]==e&&(f[K]=3),f[r]==e&&(f[r]=10),f[u]==e&&(f[u]=3.5),f[i]==e&&(f[i]=!1),f[l]==e&&(f[l]="rgba(255, 255, 114, 0.4)"),f[X]==e&&(f[X]="rgba(255, 255, 0, 0.3)"),f[z]==e&&(f[z]="rgba(255, 255, 0, 0)"),f[Z]==e&&(f[Z]=1),f[A]==e&&(f[A]=22),f[R]==e&&(f[R]=4),C.prepareRemove=function(n){V.call(this,n);var O=n._dataModel,u=O.$3e;if(u)for(var b=u.length,Q=0;b>Q;Q++)if(u[Q]===n){u.splice(Q,1);break}},H.setDataModel=function(o){var B=this,W=B._dataModel;if(W!==o){W&&(W.umm(Qp,B),W.umd(sk,B),W.$3e=[]),o.mm(Qp,B),o.md(sk,B);var b=o.$3e=[];o.each(function(C){C.s(k)&&b.indexOf(C)<0&&b.push(C)}),ic.call(B,o)}},H.setFlowInterval=function(M){var l=this,q=l.$11e;l.$11e=M,l.fp("flowInterval",q,M),l.$7e!=e&&(clearInterval(l.$7e),delete l.$7e,l.enableFlow(M))},H.getFlowInterval=function(){return this.$11e},H.$9e=function(){var k,e,Y,W=this,f=W.tx(),L=W.ty(),V=W.getZoom(),h=W.getWidth(),F=W.getHeight(),K={x:-f/V,y:-L/V,width:h/V,height:F/V},H=W.dm().$3e,l=W._56I,x=new N;if(H.forEach(function(L){l[L.getId()]&&(k=W.getDataUI(L),k&&(Y=k._79o(),Y&&x.add(Y)))}),0!==x.size()&&(x.each(function(l){p.intersectsRect(K,l)&&(e=p.unionRect(e,l))}),e&&(e&&(p.grow(e,S(1,1/V)),e.x=t(e.x*V)/V,e.y=t(e.y*V)/V,e.width=Q(e.width*V)/V,e.height=Q(e.height*V)/V,e=p.intersection(K,e)),e))){var o=W._canvas.getContext("2d");o.save(),o.lineCap=p.lineCap,o.lineJoin=p.lineJoin,m.translateAndScale(o,f,L,V),o.beginPath(),o.rect(e.x,e.y,e.width,e.height),o.clip(),o.clearRect(e.x,e.y,e.width,e.height),W.$6e(o,e),o.restore()}},H.$6e=function(U,I){var i,t,K=this;K._93db(U),K.each(function(h){K._56I[h._id]&&(i=K.getDataUI(h),i&&(t=i._79o(),(!I||p.intersectsRect(I,t))&&i._42(U)))}),K._92db(U)},H.enableFlow=function(o){var R=this,q=R.dm(),X=q.$3e;R.$7e==e&&(X.forEach(function(X){var U=R.getDataUI(X);yh(U)}),R.$7e=setInterval(function(){q.$3e.forEach(function(X){hg(R.getDataUI(X))}),R.$9e()},o||R.$11e||50))},H.disableFlow=function(){var m=this;clearInterval(m.$7e),delete m.$7e;var Z=m.dm().$3e;Z&&m.$9e()},q.$5e=function(g,Y,L,a,n){var f=this,B=f._data,q=f.gv,S=B.s(l),s=B.s(X),b=B.s(z),k=B.s(Z),M=q.$8e,$=B.s(U);if(M==e&&(M=q.$8e={}),g.beginPath(),$!=e){var _=p.getImage($),P=L/2;g.translate(Y.x,Y.y),g.rotate(n),g.translate(-Y.x,-Y.y),p.drawImage(g,_,Y.x-P,Y.y-P,L,L,B),g.translate(Y.x,Y.y),g.rotate(-n),g.translate(-Y.x,-Y.y)}else g.fillStyle=S,g.arc(Y.x,Y.y,L/2,0,O,!0),g.fill();if(k){var I=22,V=I+"_"+s+"_"+b,u=M[V];if(u==e){var r=Vq("canvas");m.setCanvas(r,I,I);var W=r.getContext("2d"),K=I/2,w=K,J=K;m.translateAndScale(W,0,0,1),W.beginPath();var t=W.createRadialGradient(w,J,0,w,w,K);t.addColorStop(0,s),t.addColorStop(1,b),W.fillStyle=t,W.arc(w,J,K,0,O,!0),W.fill(),u=M[V]=r}var P=a/2;p.drawImage(g,u,Y.x-P,Y.y-P,a,a,B)}},j._80o=function(O){L.call(this,O);var b=this,I=b._data,M=b.gv;I.s(k)&&M.$7e!=e&&Fe.call(b,O)},I._80o=function(F){w.call(this,F);var j=this,U=j._data,D=j.gv;U.s(k)&&D.$7e!=e&&Fe.call(j,F)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
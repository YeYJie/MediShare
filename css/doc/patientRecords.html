<div id="patientRecords">
	<div id="patientRecords-record">
		<h3 class="page-header media-heading" style="">病历记录</h3>
		<table id="patientRecords-table" class="table">
			<thead>
				<th>就诊医院</th>
				<th>时间</th>
				<th>诊断</th>
				<th>检查项目</th>
				<th></th>
			</thead>
			<tbody>

			</tbody>
		</table>
	 </div>
</div>

<script type="text/javascript">


	socket.on('patientRecords', function(data){

		function unixSecondToString(unixSecond) {
			var date = new Date(parseInt(unixSecond) * 1000);
			var y = date.getFullYear();
			var m = date.getMonth() + 1;
			var d = date.getDate();
			return y + '-' + m + '-' + d;
		};

		function buildRecordRow(record) {
			var recordTime = unixSecondToString(record.RecordTime);
			return ''
				+'<tr>'
				+'	<td>' + record.Hname + '</td>'
				+'	<td>' + recordTime + '</td>'
				+'	<td>' + record.Zhenduan + '</td>'
				+'	<td>' + record.Jianyan + '</td>'
				+'	<td><a id="patientRecord-' + record.RecordId
				+ '" data-rid="' + record.RecordId
				+ '" data-pid="' + data.id
				+ '" data-th="' + record.Hid
				+ '" data-doctorname="' + record.Dname
				+ '" data-targethospitalname="' + record.Hname
				+ '" data-time="' + recordTime
				+ '" class="btn btn-default btn-lg btn-block">查看细节</a></td>'
				+'</tr>';
		};

		$("#patientRecords-table").find("tr:gt(0)").remove();
		console.log('patientRecords', data);
		var patientRecords = data.records;

		if(!patientRecords) return;
		for(var i = 0; i < patientRecords.length; i++) {
			var recordRow = buildRecordRow(patientRecords[i]);
			var row = document.getElementById("patientRecords-table").insertRow(1);
			row.innerHTML = recordRow;

			$("#patientRecord-"+patientRecords[i].RecordId).click(function(){
				recordDetailTargetHospitalName = $(this).data('targethospitalname');
				recordDetailDoctorName = $(this).data('doctorname');
				recordDetailTime = $(this).data('time');

				var rid = $(this).data('rid').toString();
				var pid = $(this).data('pid').toString();
				var targetHospital = $(this).data('th');
				showRecordDetail(pid, targetHospital, rid);
			});
		}
	});

	$(function(){
	});
</script>
